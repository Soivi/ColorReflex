<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Color Reflex</title>
<link href="style.css" rel="stylesheet" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="js/finalColorListCreator.js"></script>
<script>
$(function () {
		$('#infoBar').hide();
		$('#highScoresBar').hide();
		var infobarhidden = true;
		var highscorebarhidden = true;
		var timeLeft = 360;
		var gameTime = 0;
		var yourRecord = 0;
		var hard = 4;
		var medium = 3;
		var easy = 2;
		var difficulty = easy;
		var rightAnswers = 0;
		var totalAnswers = 2;
		var colorList = finalColorList.slice();
		var gameOn = false;
		$('#rightPoints').text(rightAnswers + '/' + totalAnswers);
		$('#gameTimeText').text(gameTime);
		$('#yourRecordText').text(yourRecord);
		var timeBarInterval;
		
		for (i = colorList.length; i > 9; i--) {
			var number = Math.floor(Math.random() * colorList.length);
			colorList.splice(number, 1);
		}
		var wantedColorIndex = Math.floor(Math.random() * colorList.length)
		var rightAnswer = colorList[wantedColorIndex].rgb;
		$('#wantedColor').text(colorList[wantedColorIndex].color);
		$('#wantedColor').css('color', colorList[Math.floor(Math.random() * colorList.length)].color);
		
        var table = $('<table></table>').addClass('gameTable');
		for (j = 0; j < 3; j++) {
					row = $('<tr></tr>');
					for (i = 0; i < 3; i++) {
						var number = Math.floor(Math.random() * colorList.length);
						var row1 = $('<td></td>').addClass('bar');
						var button = $('<button></button>').css('background-color', colorList[number].color);
						button.disabled = true;
						button.addClass('colorButton');
						button.attr('id', j + '' + i );
						colorList.splice(number, 1);
						table.append(row);
						row.append(row1);
						row1.append(button);
					}

			if ($('.gameTable').length) {
				 $(".gameTable tr:first").after(row);
			}
			else {
				$('#gameArea').append(table);
			}
		}
		
		$('.colorButton').attr("disabled", true);
		
		$('.colorButton').on('click', function() {
			if($(this).css("background-color") == rightAnswer) {
				rightAnswers++;
				if(rightAnswers >= totalAnswers) {
					gameFinished();
				}
			} else {
				gameTime = gameTime + 5;
			}
			newQuestion();
		});
			
			
		function newQuestion() {
			timeLeft = 360;
						
		$('#rightPoints').text(rightAnswers + '/' + totalAnswers);

			colorList = finalColorList.slice();
			for (i = colorList.length; i > 9; i--) {
				var number = Math.floor(Math.random() * colorList.length);
				colorList.splice(number, 1);
			}
			
			wantedColorIndex = Math.floor(Math.random() * colorList.length)
			rightAnswer = colorList[wantedColorIndex].rgb;
			$('#wantedColor').text(colorList[wantedColorIndex].color);
			$('#wantedColor').css('color', colorList[Math.floor(Math.random() * colorList.length)].color);
			
			for (j = 0; j < 3; j++) {
						for (i = 0; i < 3; i++) {
							var number = Math.floor(Math.random() * colorList.length);
							var colorButtonIDtemp = j + '' + i ;
							$('#'+colorButtonIDtemp).css('background-color', colorList[number].color);
							colorList.splice(number, 1);
						}
			}
		};
		
		$('#startStopButton').on('click', function() {
			if(gameOn) {
				stopGame();
				gameOn = false;
			} else {
				startGame();
				gameOn = true;
			}
		});
		
		function startGame() {
			$('.difficultyLevel').attr("disabled", "disabled");
			$('.naviSecondRow').attr("disabled", "disabled");
			var time = 2;
			rightAnswers = 0;
			gameTime = 0;
			var interval = window.setInterval(function(){
				$('#startStopButton').text('Starting ' + time);
				if(time == 0) {
					clearInterval(interval);
					$('#startStopButton').text('Stop');
					newQuestion();
					$('.colorButton').attr("disabled", false);
					gameIsOn();
					$('.difficultyLevel').removeAttr("disabled");
					$('.naviSecondRow').removeAttr("disabled");
				}
				time--;
			}, 1000);
		}
		
		function gameIsOn() {
			timeBarInterval = window.setInterval(function(){
				gameTime = gameTime + 0.01;
				$('#gameTimeText').text(gameTime.toFixed(2));
				timeLeft = timeLeft - difficulty;
				$('#timeBarLeft').css('width', timeLeft);
				if (timeLeft <= 0) {
					gameTime = gameTime + 5;
					newQuestion()
				} else if (timeLeft < 100) {
					$('#timeBarLeft').css('background-color', 'red');
				} else if (timeLeft < 200) {
					$('#timeBarLeft').css('background-color', 'yellow');
				} else {
					$('#timeBarLeft').css('background-color', 'rgb(120,240,30)');
				}
			}, 10);
		}
		
		function stopGame() {
			$('#startStopButton').text('Start');
			clearInterval(timeBarInterval);
			$('.colorButton').attr("disabled", true);
			gameOn = false;
		}
		
		function gameFinished() {
			stopGame();
			window.alert('Your time was: ' + gameTime.toFixed(2));
			if(gameTime < yourRecord || yourRecord == 0) {
				yourRecord = gameTime.toFixed(2);
				$('#yourRecordText').text(yourRecord);
			}
		}
		
		$('.difficultyLevel').click(function(){
			document.getElementById("easy").className = "difficultyLevel";
			document.getElementById("medium").className = "difficultyLevel";
			document.getElementById("hard").className = "difficultyLevel";
			
			document.getElementById(this.id).className = "difficultyLevel activeDifficulty";
			
			stopGame();
			if(this.id == "hard") {
				difficulty = hard;
			} else if (this.id == "medium") {
				difficulty = medium;
			} else {
				difficulty = easy;
			}
		});
		
		$('#info').on('click', function() {
			if(infobarhidden) {
				document.getElementById(this.id).className = "naviSecondRow activeDifficulty";
				infobarhidden = false;
			} else {
				document.getElementById(this.id).className = "naviSecondRow";
				infobarhidden = true;
			}
			$('#infoBar').fadeToggle(1500);
		});
		
		$('#highscores').on('click', function() {
			if(highscorebarhidden) {
				document.getElementById(this.id).className = "naviSecondRow activeDifficulty";
				highscorebarhidden = false;
			} else {
				document.getElementById(this.id).className = "naviSecondRow";
				highscorebarhidden = true;
			}
			$('#highScoresBar').fadeToggle(1500);
		});

});
</script>
</head>
<body>
<div id="wholeGameArea">
<div id="navBarDiv">
<ul id="difficultyLevelNav">
<li><a class="difficultyLevel activeDifficulty" id="easy">Easy</a></li>
<li><a class="difficultyLevel" id="medium">Medium</a></li>
<li><a class="difficultyLevel" id="hard">Hard</a></li>
</ul>
<ul id="naviSecondRowNav">
<li><a class="naviSecondRow" id="info">Info</a></li>
<li><a class="naviSecondRow" id="highscores">High scores</a></li>
<li><a class="naviSecondRow" id="startStopButton">Start</a></li>
</ul>
</div>
<div id="infoBar" class="hiddenBars">
<h1>These are instructions</h1>
</div>

<div id="highScoresBar" class="hiddenBars">
<h1>Here is highscores</h1>
</div>

<table id="statisticsTable">
<tr>
<td>Points</td>
<td>Time</td>
<td>Your record</td>
</tr>
<tr>
<td id="rightPoints"></td>
<td id="gameTimeText"></td>
<td id="yourRecordText"></td>
</tr>
</table>

<h1 id="wantedColor"></h1>
<div id="timeBar"><div id="timeBarLeft"></div></div>
<div id="gameArea"></div>
</div>
</body>
</html>
